<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Login & G·ª≠i Item & Add Coin</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
html,body{
  height:100%; margin:0; padding:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f6f0f6;
  display:flex; align-items:center; justify-content:center;
  overflow:hidden;
}
.container{
  width:95%; max-width:700px; height:92%;
  background:#fff; border-radius:14px;
  box-shadow:0 8px 30px rgba(0,0,0,0.12);
  padding:28px; box-sizing:border-box;
  position:relative; overflow:hidden;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
}
h1{ margin:0 0 12px 0; color:#b91c57; font-size:28px; text-align:center;}
.sub { color:#666; margin-bottom:18px; text-align:center; }
.row { width:100%; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; }
input[type="text"], input[type="password"], input[type="number"]{
  width:calc(45% - 12px); min-width:180px;
  padding:16px; font-size:18px; border:2px solid #eee;
  border-radius:10px; text-align:center; box-sizing:border-box;
}
.full { width:calc(95% - 12px); }
button{
  background:#c2185b; color:white; border:none; padding:16px;
  border-radius:10px; cursor:pointer; font-size:18px; font-weight:700;
  width:calc(50% - 12px); min-width:180px;
}
button.secondary{ background:#555; width:calc(40% - 12px); }
hr { width:90%; border:none; border-top:1px solid #eee; margin:18px 0; }
small.note { color:#888; display:block; text-align:center; margin-top:8px; }
.sakura {
  position: absolute; top:-40px; width:26px; height:26px;
  background: url('https://i.imgur.com/5xHCn8R.png') no-repeat center/contain;
  pointer-events:none; z-index:5; animation: fall linear forwards;
}
@keyframes fall { to { transform: translateY(100%) rotate(360deg); opacity:0.9; } }
@media (max-width:520px){
  input[type="text"], input[type="password"], input[type="number"]{ width:90%; }
  button{ width:90%; margin-top:8px; }
}
</style>
</head>
<body>
<div class="container" id="formContainer">
<h1>Login & G·ª≠i Item & Add Coin</h1>
<div class="sub">Nh·∫≠p t√†i kho·∫£n, ƒëƒÉng nh·∫≠p ƒë·ªÉ l·∫•y cookie t·ª± ƒë·ªông ‚Äî sau ƒë√≥ nh·∫≠p ID ITEM ho·∫∑c s·ªë coin ƒë·ªÉ g·ª≠i</div>

<!-- LOGIN -->
<div class="row" style="margin-bottom:12px;">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
</div>
<div class="row" style="margin-bottom:8px;">
<button onclick="loginAndSaveCookie()">üîë Login & L∆∞u Cookie</button>
<button class="secondary" onclick="clearCookie()">üßπ X√≥a Cookie</button>
</div>
<small class="note">Cookie hi·ªán t·∫°i: <span id="cookiePreview" style="font-weight:600;color:#333">Ch∆∞a c√≥</span></small>

<hr>

<!-- G·ª¨I ITEM -->
<div class="row" style="margin-top:6px;">
<input type="text" id="reward" placeholder="Nh·∫≠p ID ITEM">
<input type="number" id="quantity" placeholder="S·ªë l∆∞·ª£ng" min="1">
</div>
<div class="row" style="margin-top:12px;">
<button onclick="sendItem()">üöÄ G·ª≠i Item</button>
</div>
<small class="note">Cookie ƒë∆∞·ª£c l·∫•y qua API login proxy.</small>

<hr>

<!-- ADD COIN -->
<div class="row" style="margin-top:6px;">
<input type="number" id="coinAmount" placeholder="S·ªë l∆∞·ª£ng coin" min="1">
<button onclick="addCoin()">‚ûï ADD COIN</button>
</div>
<small class="note">ADD COIN s·∫Ω g·ª≠i type=Tanthu & amount t·ªõi server g·ªëc.</small>
</div>

<script>
const VERCEL_BASE = "https://bug-blush.vercel.app"; 
const LOGIN_API = VERCEL_BASE + "/api/login";
const SEND_API  = VERCEL_BASE + "/api/proxy";

window.addEventListener('load',()=>updateCookiePreview());

function updateCookiePreview(){
  const c = localStorage.getItem('cookie') || '';
  const preview = c ? c : "Ch∆∞a c√≥"; 
  document.getElementById('cookiePreview').textContent = preview;
}

function clearCookie(){
  localStorage.removeItem('cookie');
  Swal.fire('ƒê√£ x√≥a','Cookie ƒë√£ ƒë∆∞·ª£c x√≥a kh·ªèi tr√¨nh duy·ªát','success');
  updateCookiePreview();
}

// LOGIN
async function loginAndSaveCookie(){
  const username=document.getElementById('username').value.trim();
  const password=document.getElementById('password').value.trim();
  if(!username||!password){Swal.fire('Ch∆∞a ƒë·ªß d·ªØ li·ªáu','Vui l√≤ng nh·∫≠p username v√† password','warning'); return;}
  try{
    const res=await fetch(LOGIN_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({username,password})
    });
    const data=await res.json();
    if(data && data.cookie && data.cookie.length){
      localStorage.setItem('cookie',data.cookie);
      Swal.fire('Login th√†nh c√¥ng','Cookie ƒë√£ ƒë∆∞·ª£c l∆∞u. B·∫°n c√≥ th·ªÉ g·ª≠i item ho·∫∑c ADD COIN.','success');
      updateCookiePreview();
      return;
    }
    const raw=data&&data.raw?data.raw:JSON.stringify(data);
    Swal.fire('Kh√¥ng l·∫•y ƒë∆∞·ª£c cookie','Server tr·∫£: '+raw,'error');
  }catch(err){
    Swal.fire('L·ªói k·∫øt n·ªëi','Kh√¥ng th·ªÉ g·ªçi API login: '+err.message,'error');
    console.error(err);
  }
}

// SEND ITEM
async function sendItem(){
  const cookie=localStorage.getItem('cookie')||"";
  const reward=document.getElementById('reward').value.trim();
  const quantity=document.getElementById('quantity').value.trim();
  if(!cookie){Swal.fire('Ch∆∞a login','B·∫°n c·∫ßn login ƒë·ªÉ l·∫•y cookie tr∆∞·ªõc','warning'); return;}
  if(!reward||!quantity){Swal.fire('Thi·∫øu d·ªØ li·ªáu','Vui l√≤ng nh·∫≠p ID ITEM v√† S·ªë l∆∞·ª£ng','warning'); return;}
  try{
    await fetch(SEND_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({cookie,reward,quantity})
    });
    document.getElementById('reward').value="";
    document.getElementById('quantity').value="";
    Swal.fire({icon:'success',title:'Th√†nh c√¥ng üéâ',text:'ƒê√£ g·ª≠i item v√†o h√†nh trang. Vui l√≤ng ki·ªÉm tra!',confirmButtonText:'OK'});
    for(let i=0;i<18;i++) createSakura();
  }catch(err){
    Swal.fire('L·ªói','G·ª≠i item th·∫•t b·∫°i: '+err.message,'error');
    console.error(err);
  }
}

// ADD COIN
async function addCoin(){
  const cookie=localStorage.getItem('cookie')||"";
  const amount=document.getElementById('coinAmount').value.trim();
  if(!cookie){Swal.fire('Ch∆∞a login','B·∫°n c·∫ßn login ƒë·ªÉ l·∫•y cookie tr∆∞·ªõc','warning'); return;}
  if(!amount){Swal.fire('Thi·∫øu d·ªØ li·ªáu','Vui l√≤ng nh·∫≠p s·ªë coin','warning'); return;}
  try{
    await fetch(SEND_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({cookie, params:{type:"Tanthu", amount}})
    });
    document.getElementById('coinAmount').value="";
    Swal.fire({icon:'success',title:'Th√†nh c√¥ng üéâ',text:'ƒê√£ g·ª≠i coin. Vui l√≤ng ki·ªÉm tra!',confirmButtonText:'OK'});
  }catch(err){
    Swal.fire('L·ªói','G·ª≠i coin th·∫•t b·∫°i: '+err.message,'error');
    console.error(err);
  }
}

// Hoa r∆°i khi g·ª≠i item
function createSakura(){
  const container=document.getElementById('formContainer');
  if(!container)return;
  const sakura=document.createElement('div');
  sakura.className='sakura';
  const maxLeft=Math.max(0,container.clientWidth-30);
  sakura.style.left=(Math.random()*maxLeft)+'px';
  sakura.style.top=(-Math.random()*40)+'px';
  sakura.style.animationDuration=(Math.random()*1.6+1.6)+'s';
  container.appendChild(sakura);
  setTimeout(()=>sakura.remove(),4200);
}
</script>
</body>
</html>
