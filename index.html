<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Login & Gửi Item & Add Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
html, body { height:100%; margin:0; font-family:Arial; background:#f6f0f6; overflow:auto; }
.container { max-width:700px; margin:20px auto; padding:20px; background:#fff; border-radius:14px; box-shadow:0 8px 30px rgba(0,0,0,0.12); display:flex; flex-direction:column; gap:16px; }
h1 { text-align:center; color:#b91c57; }
input, button { width:100%; padding:16px; font-size:18px; margin-bottom:8px; border-radius:10px; border:2px solid #eee; text-align:center; }
button { background:#c2185b; color:white; border:none; cursor:pointer; font-weight:700; }
</style>
</head>
<body>
<div class="container">
<h1>Login & Gửi Item & Add Coin</h1>

<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">🔑 Login</button>

<hr>

<input type="text" id="reward" placeholder="Nhập ID ITEM">
<input type="number" id="quantity" placeholder="Số lượng" min="1">
<button onclick="sendItem()">🚀 Gửi Item</button>

<hr>

<input type="number" id="coinAmount" placeholder="Số lượng coin" min="1">
<button onclick="addCoin()">➕ ADD COIN</button>
</div>

<script>
const VERCEL_BASE = "https://bug-blush.vercel.app";

async function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username||!password){Swal.fire('Thiếu dữ liệu','Điền đầy đủ username và password','warning'); return;}
  try{
    const res = await fetch(VERCEL_BASE+'/api/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username,password})
    });
    const data = await res.json();
    if(data.ok) Swal.fire('Login thành công','Bạn đã đăng nhập thực sự','success');
    else Swal.fire('Login thất bại',data.message,'error');
  }catch(err){Swal.fire('Lỗi',err.message,'error');}
}

async function sendItem(){
  const username=document.getElementById('username').value.trim();
  const password=document.getElementById('password').value.trim();
  const reward=document.getElementById('reward').value.trim();
  const quantity=document.getElementById('quantity').value.trim();
  if(!username||!password||!reward||!quantity){Swal.fire('Thiếu dữ liệu','Điền đầy đủ','warning'); return;}
  try{
    const loginRes=await fetch(VERCEL_BASE+'/api/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username,password})
    });
    const loginData=await loginRes.json();
    if(!loginData.ok){Swal.fire('Login thất bại','Không lấy được cookie','error'); return;}
    await fetch(VERCEL_BASE+'/api/proxy',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({cookie:loginData.cookie,reward,quantity})
    });
    Swal.fire('Thành công','Đã gửi item. Reload trang','success').then(()=>location.reload());
  }catch(err){Swal.fire('Lỗi',err.message,'error');}
}

async function addCoin(){
  const username=document.getElementById('username').value.trim();
  const password=document.getElementById('password').value.trim();
  const amount=document.getElementById('coinAmount').value.trim();
  if(!username||!password||!amount){Swal.fire('Thiếu dữ liệu','Điền đầy đủ','warning'); return;}
  try{
    const loginRes=await fetch(VERCEL_BASE+'/api/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username,password})
    });
    const loginData=await loginRes.json();
    if(!loginData.ok){Swal.fire('Login thất bại','Không lấy được cookie','error'); return;}
    await fetch(VERCEL_BASE+'/api/proxy',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({cookie:loginData.cookie,params:{type:"Tanthu",amount}})
    });
    Swal.fire('Thành công','Đã add coin. Reload trang','success').then(()=>location.reload());
  }catch(err){Swal.fire('Lỗi',err.message,'error');}
}
</script>
</body>
</html>
