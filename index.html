<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Login & Gửi Item & Add Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #f6f0f6;
  overflow: auto;
}

.container {
  width: 95%;
  max-width: 700px;
  max-height: 95%;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  padding: 20px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  color: #b91c57;
  font-size: 36px;
  text-align: center;
  margin-bottom: 16px;
}

.sub {
  color: #666;
  margin-bottom: 20px;
  text-align: center;
}

.row {
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}

input[type="text"], input[type="password"], input[type="number"] {
  width: 40%;
  min-width: 180px;
  padding: 20px;
  font-size: 20px;
  border-radius: 12px;
  border: 2px solid #eee;
  text-align: center;
  box-sizing: border-box;
}

button {
  padding: 20px;
  font-size: 22px;
  font-weight: 700;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  width: 45%;
  min-width: 180px;
  background: #c2185b;
  color: #fff;
}

button.secondary {
  background: #555;
  width: 40%;
}

hr {
  width: 90%;
  border: none;
  border-top: 1px solid #eee;
  margin: 20px 0;
}

small.note {
  color: #888;
  text-align: center;
  display: block;
  margin-top: 8px;
}

@media(max-width:600px){
  input[type="text"], input[type="password"], input[type="number"], button {
    width: 90%;
    margin-top: 10px;
  }
}
</style>
</head>
<body>
<div class="container">
<h1>Login & Gửi Item & Add Coin</h1>
<div class="sub">Nhập username/password để login → lưu cookie → dùng cookie gửi Item hoặc ADD COIN</div>

<!-- Login -->
<div class="row">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
</div>
<div class="row">
<button onclick="loginAndSaveCookie()">🔑 Login & Lưu Cookie</button>
<button class="secondary" onclick="logout()">🚪 Logout</button>
</div>
<small class="note">Bạn đang đăng nhập tài khoản: <span id="cookiePreview">Chưa đăng nhập</span></small>

<hr>

<!-- Send Item -->
<div class="row">
<input type="text" id="reward" placeholder="Nhập ID ITEM">
<input type="number" id="quantity" placeholder="Số lượng" min="1">
</div>
<div class="row">
<button onclick="sendItem()">🚀 Gửi Item</button>
</div>

<hr>

<!-- Add Coin -->
<div class="row">
<input type="number" id="addAmount" placeholder="Nhập số coin (amount)" min="1">
<button onclick="addCoin()">➕ ADD COIN</button>
</div>
<small class="note">ADD COIN sẽ gửi type=Tanthu & amount tới server gốc.</small>

</div>

<script>
const LOGIN_API = "https://<your-vercel>.vercel.app/api/login"; // proxy login
const ACTION_API = "https://<your-vercel>.vercel.app/api/proxy"; // proxy send item/add coin

// Hiển thị username hiện tại
window.addEventListener('load', ()=>updateCookiePreview());
function updateCookiePreview(){
  const username = localStorage.getItem('username') || '';
  document.getElementById('cookiePreview').textContent = username || "Chưa đăng nhập";
}

// Logout
function logout(){
  localStorage.removeItem('cookie');
  localStorage.removeItem('username');
  Swal.fire('Đã đăng xuất','Bạn đã đăng xuất','success');
  updateCookiePreview();
}

// Login
async function loginAndSaveCookie(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password){ Swal.fire('Thiếu dữ liệu','Nhập username/password','warning'); return; }

  try{
    const res = await fetch(LOGIN_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ username, password })
    });
    const data = await res.json();
    if(data && data.cookie){
      localStorage.setItem('cookie', data.cookie);
      localStorage.setItem('username', username);
      Swal.fire('Đăng nhập thành công','Cookie đã lưu','success');
      updateCookiePreview();
    }else{
     
