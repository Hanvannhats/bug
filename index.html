<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Login & Gá»­i Item & Add Coin</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
/* (giá»¯ nguyÃªn style tá»« báº£n trÆ°á»›c) */
html,body{height:100%;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;background:#f6f0f6;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.container{width:95%;max-width:700px;height:92%;background:#fff;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,0.12);padding:28px;box-sizing:border-box;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;}
h1{margin:0 0 12px 0;color:#b91c57;font-size:28px;text-align:center;}
.sub{color:#666;margin-bottom:18px;text-align:center;}
.row{width:100%;display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;}
input[type="text"],input[type="password"],input[type="number"]{width:calc(45% - 12px);min-width:180px;padding:16px;font-size:18px;border:2px solid #eee;border-radius:10px;text-align:center;box-sizing:border-box;}
.full{width:calc(95% - 12px);}
button{background:#c2185b;color:white;border:none;padding:16px;border-radius:10px;cursor:pointer;font-size:18px;font-weight:700;width:calc(50% - 12px);min-width:180px;}
button.secondary{background:#555;width:calc(40% - 12px);}
hr{width:90%;border:none;border-top:1px solid #eee;margin:18px 0;}
small.note{color:#888;display:block;text-align:center;margin-top:8px;}
.sakura{position:absolute;top:-40px;width:26px;height:26px;background:url('https://i.imgur.com/5xHCn8R.png') no-repeat center/contain;pointer-events:none;z-index:5;animation:fall linear forwards;}
@keyframes fall{to{transform:translateY(100%) rotate(360deg);opacity:0.9}}
@media(max-width:520px){input[type="text"],input[type="password"],input[type="number"]{width:90%;}button{width:90%;margin-top:8px}}
</style>
</head>
<body>
<div class="container" id="formContainer">
  <h1>Login & Gá»­i Item & Add Coin</h1>
  <div class="sub">Login Ä‘á»ƒ láº¥y cookie â†’ dÃ¹ng cookie gá»­i item hoáº·c ADD COIN</div>

  <!-- LOGIN -->
  <div class="row" style="margin-bottom:12px;">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
  </div>
  <div class="row" style="margin-bottom:8px;">
    <button onclick="loginAndSaveCookie()">ğŸ”‘ Login & LÆ°u Cookie</button>
    <button class="secondary" onclick="logout()">ğŸšª Logout</button>
  </div>
  <small class="note">Báº¡n Ä‘ang Ä‘Äƒng nháº­p tÃ i khoáº£n cÃ³ tÃªn lÃ  <span id="cookiePreview" style="font-weight:600;color:#333">ChÆ°a Ä‘Äƒng nháº­p</span></small>

  <hr>

  <!-- Gá»¬I ITEM -->
  <div class="row" style="margin-top:6px;">
    <input type="text" id="reward" placeholder="Nháº­p ID ITEM">
    <input type="number" id="quantity" placeholder="Sá»‘ lÆ°á»£ng" min="1">
  </div>
  <div class="row" style="margin-top:12px;">
    <button onclick="sendItem()">ğŸš€ Gá»­i Item</button>
  </div>

  <hr>

  <!-- ADD COIN -->
  <div style="width:100%; margin-top:10px;">
    <div class="row">
      <input type="number" id="addAmount" placeholder="Nháº­p sá»‘ coin (amount)" min="1" style="width:calc(45% - 12px);">
      <div style="width:calc(45% - 12px); display:flex; justify-content:center; align-items:center;">
        <button onclick="addCoin()" style="width:100%;">â• ADD COIN</button>
      </div>
    </div>
    <small class="note">HÃ nh Ä‘á»™ng ADD COIN sáº½ gá»­i `type=Tanthu&amount=...` tá»›i server gá»‘c.</small>
  </div>

</div>

<script>
const VERCEL_BASE = "https://bug-blush.vercel.app";
const LOGIN_API = VERCEL_BASE + "/api/login";
const SEND_API  = VERCEL_BASE + "/api/proxy";

window.addEventListener('load', ()=> updateCookiePreview());

function updateCookiePreview(){
  const username = localStorage.getItem('username') || '';
  const display = username ? username : "ChÆ°a Ä‘Äƒng nháº­p";
  document.getElementById('cookiePreview').textContent = display;
}

function logout(){
  localStorage.removeItem('cookie');
  localStorage.removeItem('username');
  Swal.fire('ÄÃ£ Ä‘Äƒng xuáº¥t','Báº¡n Ä‘Ã£ Ä‘Äƒng xuáº¥t','success');
  updateCookiePreview();
}

async function loginAndSaveCookie(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password){ Swal.fire('ChÆ°a Ä‘á»§ dá»¯ liá»‡u','Vui lÃ²ng nháº­p username vÃ  password','warning'); return; }
  try {
    const res = await fetch(LOGIN_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if(data && data.cookie && data.cookie.length){
      localStorage.setItem('cookie', data.cookie);
      localStorage.setItem('username', username);
      Swal.fire('Login thÃ nh cÃ´ng','Cookie Ä‘Ã£ Ä‘Æ°á»£c lÆ°u.','success');
      updateCookiePreview();
      return;
    }
    const raw = data && data.raw ? data.raw : JSON.stringify(data);
    Swal.fire('KhÃ´ng láº¥y Ä‘Æ°á»£c cookie','Server tráº£: ' + raw,'error');
  } catch(err) {
    Swal.fire('Lá»—i káº¿t ná»‘i','KhÃ´ng thá»ƒ gá»i API login: ' + err.message,'error');
    console.error(err);
  }
}

// Gá»­i item (giá»¯ hÃ nh xá»­ nhÆ° trÆ°á»›c)
async function sendItem(){
  const cookie = localStorage.getItem('cookie') || "";
  const reward = document.getElementById('reward').value.trim();
  const quantity = document.getElementById('quantity').value.trim();
  if(!cookie){ Swal.fire('ChÆ°a login','Báº¡n cáº§n login Ä‘á»ƒ láº¥y cookie trÆ°á»›c','warning'); return; }
  if(!reward || !quantity){ Swal.fire('Thiáº¿u dá»¯ liá»‡u','Vui lÃ²ng nháº­p ID ITEM vÃ  sá»‘ lÆ°á»£ng','warning'); return; }
  try {
    const res = await fetch(SEND_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ cookie, params: { type: "spin", reward, quantity, name: "Chuy%2525E1%2525BB%252583n%252BTinh%252BTh%2525E1%2525BA%2525A1ch" } })
    });
    const data = await res.json().catch(()=>null);
    document.getElementById('reward').value = "";
    document.getElementById('quantity').value = "";
    Swal.fire('ThÃ nh cÃ´ng','ÄÃ£ gá»­i item.','success');
    for(let i=0;i<15;i++) createSakura();
  } catch(err){
    Swal.fire('Lá»—i','Gá»­i item tháº¥t báº¡i: ' + err.message,'error');
    console.error(err);
  }
}

// ADD COIN -> gá»­i type=Tanthu & amount
async function addCoin(){
  const cookie = localStorage.getItem('cookie') || "";
  const amount = document.getElementById('addAmount').value.trim();
  if(!cookie){ Swal.fire('ChÆ°a login','Báº¡n cáº§n login Ä‘á»ƒ láº¥y cookie trÆ°á»›c','warning'); return; }
  if(!amount){ Swal.fire('Thiáº¿u dá»¯ liá»‡u','Vui lÃ²ng nháº­p sá»‘ coin', 'warning'); return; }

  try {
    const res = await fetch(SEND_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      // gá»­i params Ä‘á»™ng: type=Tanthu, amount=...
      body: JSON.stringify({ cookie, params: { type: "Tanthu", amount } })
    });
    const data = await res.json().catch(()=>null);

    // show result message (náº¿u proxy tráº£ message/raw) hoáº·c generic
    const msg = data && data.message ? data.message : (data && data.raw ? data.raw : "ÄÃ£ gá»­i yÃªu cáº§u ADD COIN. Vui lÃ²ng kiá»ƒm tra.");
    Swal.fire({ icon: (data && data.success) ? 'success' : 'success', title: 'ADD COIN', text: msg });
    // reset input amount
    document.getElementById('addAmount').value = "";
    // hoa rÆ¡i Äƒn má»«ng
    for(let i=0;i<12;i++) createSakura();
  } catch(err){
    Swal.fire('Lá»—i','ADD COIN tháº¥t báº¡i: ' + err.message,'error');
    console.error(err);
  }
}

// hoa rÆ¡i trong form
function createSakura(){
  const container = document.getElementById('formContainer');
  if(!container) return;
  const sakura = document.createElement('div');
  sakura.className = 'sakura';
  const maxLeft = Math.max(0, container.clientWidth - 30);
  sakura.style.left = (Math.random() * maxLeft) + 'px';
  sakura.style.top  = (-Math.random() * 40) + 'px';
  sakura.style.animationDuration = (Math.random() * 1.6 + 1.6) + 's';
  container.appendChild(sakura);
  setTimeout(()=> sakura.remove(), 4200);
}
</script>
</body>
</html>
