<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Login & G·ª≠i Item & Add Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #f6f0f6;
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  width: 95%;
  max-width: 700px;
  height: 90%;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

h1 {
  color: #b91c57;
  font-size: 32px;
  text-align: center;
  margin-bottom: 12px;
}

.sub {
  color: #666;
  margin-bottom: 18px;
  text-align: center;
}

.row {
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

input[type="text"], input[type="password"], input[type="number"] {
  width: calc(45% - 12px);
  min-width: 200px;
  padding: 18px;
  font-size: 20px;
  border-radius: 12px;
  border: 2px solid #eee;
  text-align: center;
  box-sizing: border-box;
}

button {
  padding: 18px;
  font-size: 20px;
  font-weight: 700;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  width: calc(50% - 12px);
  min-width: 200px;
  background: #c2185b;
  color: #fff;
}

button.secondary {
  background: #555;
  width: calc(40% - 12px);
}

hr {
  width: 90%;
  border: none;
  border-top: 1px solid #eee;
  margin: 18px 0;
}

small.note {
  color: #888;
  text-align: center;
  display: block;
  margin-top: 8px;
}

.sakura {
  position: absolute;
  top: -40px;
  width: 26px;
  height: 26px;
  background: url('https://i.imgur.com/5xHCn8R.png') no-repeat center/contain;
  pointer-events: none;
  z-index: 5;
  animation: fall linear forwards;
}

@keyframes fall { to { transform: translateY(100%) rotate(360deg); opacity: 0.9; } }

@media(max-width:520px){
  input[type="text"], input[type="password"], input[type="number"], button {
    width: 90%;
    margin-top: 8px;
  }
}
</style>
</head>
<body>
<div class="container" id="formContainer">
<h1>Login & G·ª≠i Item & Add Coin</h1>
<div class="sub">Login ƒë·ªÉ l·∫•y cookie ‚Üí d√πng cookie g·ª≠i item ho·∫∑c ADD COIN</div>

<!-- Login -->
<div class="row">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
</div>
<div class="row">
<button onclick="loginAndSaveCookie()">üîë Login & L∆∞u Cookie</button>
<button class="secondary" onclick="logout()">üö™ Logout</button>
</div>
<small class="note">B·∫°n ƒëang ƒëƒÉng nh·∫≠p t√†i kho·∫£n: <span id="cookiePreview">Ch∆∞a ƒëƒÉng nh·∫≠p</span></small>

<hr>

<!-- Send Item -->
<div class="row">
<input type="text" id="reward" placeholder="Nh·∫≠p ID ITEM">
<input type="number" id="quantity" placeholder="S·ªë l∆∞·ª£ng" min="1">
</div>
<div class="row">
<button onclick="sendItem()">üöÄ G·ª≠i Item</button>
</div>

<hr>

<!-- Add Coin -->
<div class="row">
<input type="number" id="addAmount" placeholder="Nh·∫≠p s·ªë coin (amount)" min="1">
<button onclick="addCoin()">‚ûï ADD COIN</button>
</div>
<small class="note">H√†nh ƒë·ªông ADD COIN s·∫Ω g·ª≠i type=Tanthu & amount t·ªõi server g·ªëc.</small>

</div>

<script>
const SEND_API = "https://bug-blush.vercel.app/api/proxy";

// C·∫≠p nh·∫≠t hi·ªÉn th·ªã cookie/username
window.addEventListener('load', ()=>updateCookiePreview());
function updateCookiePreview(){
  const username = localStorage.getItem('username') || '';
  document.getElementById('cookiePreview').textContent = username || "Ch∆∞a ƒëƒÉng nh·∫≠p";
}

// Logout
function logout(){
  localStorage.removeItem('cookie');
  localStorage.removeItem('username');
  Swal.fire('ƒê√£ ƒëƒÉng xu·∫•t','B·∫°n ƒë√£ ƒëƒÉng xu·∫•t','success');
  updateCookiePreview();
}

// Login
async function loginAndSaveCookie(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password){ Swal.fire('Thi·∫øu d·ªØ li·ªáu','Vui l√≤ng ƒëi·ªÅn username v√† password','warning'); return; }

  try{
    const res = await fetch(SEND_API, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ params:{ type:"Login", username, password } })
    });
    const data = await res.json().catch(()=>null);
    if(data && data.success){
      localStorage.setItem('cookie', data.raw||'');
      localStorage.setItem('username', username);
      Swal.fire('ƒêƒÉng nh·∫≠p th√†nh c√¥ng','Cookie ƒë√£ l∆∞u','success');
      updateCookiePreview();
    }else{
      Swal.fire('ƒêƒÉng nh·∫≠p th·∫•t b·∫°i','Ki·ªÉm tra username/password','error');
    }
  }catch(err){
    Swal.fire('L·ªói','Kh√¥ng th·ªÉ login: '+err.message,'error');
  }
}

// G·ª≠i Item
async function sendItem(){
  const cookie = localStorage.getItem('cookie')||"";
  const reward = document.getElementById('reward').value.trim();
  const quantity = document.getElementById('quantity').value.trim();
  if(!cookie){ Swal.fire('Ch∆∞a login','B·∫°n c·∫ßn login','warning'); return; }
  if(!reward || !quantity){ Swal.fire('Thi·∫øu d·ªØ li·ªáu','Nh·∫≠p reward v√† quantity','warning'); return; }

  try{
    const res = await fetch(SEND_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ cookie, params:{ type:"spin", reward, quantity } })
    });
    const data = await res.json().catch(()=>null);
    Swal.fire('G·ª≠i Item', data && data.message ? data.message : "ƒê√£ g·ª≠i item", (data && data.success)?'success':'error');
    document.getElementById('reward').value="";
    document.getElementById('quantity').value="";
    for(let i=0;i<12;i++) createSakura();
  }catch(err){
    Swal.fire('L·ªói','G·ª≠i item th·∫•t b·∫°i: '+err.message,'error');
  }
}

// Add Coin
async function addCoin(){
  const cookie = localStorage.getItem('cookie')||"";
  const amount = document.getElementById('addAmount').value.trim();
  if(!cookie){ Swal.fire('Ch∆∞a login','B·∫°n c·∫ßn login','warning'); return; }
  if(!amount){ Swal.fire('Thi·∫øu d·ªØ li·ªáu','Nh·∫≠p s·ªë coin','warning'); return; }

  try{
    const res = await fetch(SEND_API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ cookie, params:{ type:"Tanthu", amount } })
    });
    const data = await res.json().catch(()=>null);
    Swal.fire('ADD COIN', data && data.message ? data.message : "ƒê√£ g·ª≠i ADD COIN", (data && data.success)?'success':'error');
    document.getElementById('addAmount').value="";
    for(let i=0;i<12;i++) createSakura();
  }catch(err){
    Swal.fire('L·ªói','ADD COIN th·∫•t b·∫°i: '+err.message,'error');
  }
}

// Hoa r∆°i
function createSakura(){
  const container = document.getElementById('formContainer');
  if(!container) return;
  const sakura = document.createElement('div');
  sakura.className = 'sakura';
  sakura.style.left = (Math.random()*(container.clientWidth-30))+'px';
  sakura.style.top = (-Math.random()*40)+'px';
  sakura.style.animationDuration = (Math.random()*1.6+1.6)+'s';
  container.appendChild(sakura);
  setTimeout(()=>sakura.remove(),4200);
}
</script>
</body>
</html>
